import * as cdk from "aws-cdk-lib";
import * as ec2 from "aws-cdk-lib/aws-ec2";
import { Construct } from "constructs";
/**
 * VPC Construct for stingy-vpn
 * Creates a simple VPC with a single public subnet for the VPN server
 */
export class VpcConstruct extends Construct {
    vpc;
    securityGroup;
    subnet;
    constructor(scope, id, props) {
        super(scope, id);
        const enableSsh = props.enableSsh ?? true;
        // Create VPC with a single public subnet
        this.vpc = new ec2.Vpc(this, "Vpc", {
            ipAddresses: ec2.IpAddresses.cidr(props.vpcCidr),
            maxAzs: 1,
            natGateways: 0, // No NAT Gateway to reduce costs
            subnetConfiguration: [
                {
                    name: "Public",
                    subnetType: ec2.SubnetType.PUBLIC,
                    cidrMask: 24,
                },
            ],
            enableDnsHostnames: true,
            enableDnsSupport: true,
        });
        // Get the public subnet
        this.subnet = this.vpc.publicSubnets[0];
        // Create Security Group for WireGuard
        this.securityGroup = new ec2.SecurityGroup(this, "SecurityGroup", {
            vpc: this.vpc,
            description: "Security group for WireGuard VPN server",
            allowAllOutbound: true,
        });
        // Allow WireGuard UDP traffic
        this.securityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.udp(props.wireguardPort), "Allow WireGuard UDP traffic");
        // Allow SSH access if enabled
        if (enableSsh) {
            this.securityGroup.addIngressRule(ec2.Peer.anyIpv4(), ec2.Port.tcp(22), "Allow SSH access");
        }
        // Add tags
        cdk.Tags.of(this.vpc).add("Name", "stingy-vpn-vpc");
        cdk.Tags.of(this.securityGroup).add("Name", "stingy-vpn-sg");
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidnBjLWNvbnN0cnVjdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jZGsvbGliL2NvbnN0cnVjdHMvdnBjLWNvbnN0cnVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssR0FBRyxNQUFNLGFBQWEsQ0FBQztBQUNuQyxPQUFPLEtBQUssR0FBRyxNQUFNLHFCQUFxQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFXdkM7OztHQUdHO0FBQ0gsTUFBTSxPQUFPLFlBQWEsU0FBUSxTQUFTO0lBQ3pCLEdBQUcsQ0FBVTtJQUNiLGFBQWEsQ0FBb0I7SUFDakMsTUFBTSxDQUFjO0lBRXBDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBd0I7UUFDaEUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQixNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQztRQUUxQyx5Q0FBeUM7UUFDekMsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRTtZQUNsQyxXQUFXLEVBQUUsR0FBRyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQztZQUNoRCxNQUFNLEVBQUUsQ0FBQztZQUNULFdBQVcsRUFBRSxDQUFDLEVBQUUsaUNBQWlDO1lBQ2pELG1CQUFtQixFQUFFO2dCQUNuQjtvQkFDRSxJQUFJLEVBQUUsUUFBUTtvQkFDZCxVQUFVLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxNQUFNO29CQUNqQyxRQUFRLEVBQUUsRUFBRTtpQkFDYjthQUNGO1lBQ0Qsa0JBQWtCLEVBQUUsSUFBSTtZQUN4QixnQkFBZ0IsRUFBRSxJQUFJO1NBQ3ZCLENBQUMsQ0FBQztRQUVILHdCQUF3QjtRQUN4QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXhDLHNDQUFzQztRQUN0QyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksR0FBRyxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsZUFBZSxFQUFFO1lBQ2hFLEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRztZQUNiLFdBQVcsRUFBRSx5Q0FBeUM7WUFDdEQsZ0JBQWdCLEVBQUUsSUFBSTtTQUN2QixDQUFDLENBQUM7UUFFSCw4QkFBOEI7UUFDOUIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQy9CLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEVBQ2xCLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsRUFDakMsNkJBQTZCLENBQzlCLENBQUM7UUFFRiw4QkFBOEI7UUFDOUIsSUFBSSxTQUFTLEVBQUUsQ0FBQztZQUNkLElBQUksQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUMvQixHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxFQUNsQixHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFDaEIsa0JBQWtCLENBQ25CLENBQUM7UUFDSixDQUFDO1FBRUQsV0FBVztRQUNYLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLGdCQUFnQixDQUFDLENBQUM7UUFDcEQsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsZUFBZSxDQUFDLENBQUM7SUFDL0QsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgY2RrIGZyb20gXCJhd3MtY2RrLWxpYlwiO1xuaW1wb3J0ICogYXMgZWMyIGZyb20gXCJhd3MtY2RrLWxpYi9hd3MtZWMyXCI7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tIFwiY29uc3RydWN0c1wiO1xuXG5leHBvcnQgaW50ZXJmYWNlIFZwY0NvbnN0cnVjdFByb3BzIHtcbiAgLyoqIFZQQyBDSURSIGJsb2NrICovXG4gIHJlYWRvbmx5IHZwY0NpZHI6IHN0cmluZztcbiAgLyoqIFdpcmVHdWFyZCBVRFAgcG9ydCAqL1xuICByZWFkb25seSB3aXJlZ3VhcmRQb3J0OiBudW1iZXI7XG4gIC8qKiBFbmFibGUgU1NIIGFjY2VzcyAoVENQIDIyKSAqL1xuICByZWFkb25seSBlbmFibGVTc2g/OiBib29sZWFuO1xufVxuXG4vKipcbiAqIFZQQyBDb25zdHJ1Y3QgZm9yIHN0aW5neS12cG5cbiAqIENyZWF0ZXMgYSBzaW1wbGUgVlBDIHdpdGggYSBzaW5nbGUgcHVibGljIHN1Ym5ldCBmb3IgdGhlIFZQTiBzZXJ2ZXJcbiAqL1xuZXhwb3J0IGNsYXNzIFZwY0NvbnN0cnVjdCBleHRlbmRzIENvbnN0cnVjdCB7XG4gIHB1YmxpYyByZWFkb25seSB2cGM6IGVjMi5WcGM7XG4gIHB1YmxpYyByZWFkb25seSBzZWN1cml0eUdyb3VwOiBlYzIuU2VjdXJpdHlHcm91cDtcbiAgcHVibGljIHJlYWRvbmx5IHN1Ym5ldDogZWMyLklTdWJuZXQ7XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IFZwY0NvbnN0cnVjdFByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIGNvbnN0IGVuYWJsZVNzaCA9IHByb3BzLmVuYWJsZVNzaCA/PyB0cnVlO1xuXG4gICAgLy8gQ3JlYXRlIFZQQyB3aXRoIGEgc2luZ2xlIHB1YmxpYyBzdWJuZXRcbiAgICB0aGlzLnZwYyA9IG5ldyBlYzIuVnBjKHRoaXMsIFwiVnBjXCIsIHtcbiAgICAgIGlwQWRkcmVzc2VzOiBlYzIuSXBBZGRyZXNzZXMuY2lkcihwcm9wcy52cGNDaWRyKSxcbiAgICAgIG1heEF6czogMSxcbiAgICAgIG5hdEdhdGV3YXlzOiAwLCAvLyBObyBOQVQgR2F0ZXdheSB0byByZWR1Y2UgY29zdHNcbiAgICAgIHN1Ym5ldENvbmZpZ3VyYXRpb246IFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6IFwiUHVibGljXCIsXG4gICAgICAgICAgc3VibmV0VHlwZTogZWMyLlN1Ym5ldFR5cGUuUFVCTElDLFxuICAgICAgICAgIGNpZHJNYXNrOiAyNCxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBlbmFibGVEbnNIb3N0bmFtZXM6IHRydWUsXG4gICAgICBlbmFibGVEbnNTdXBwb3J0OiB0cnVlLFxuICAgIH0pO1xuXG4gICAgLy8gR2V0IHRoZSBwdWJsaWMgc3VibmV0XG4gICAgdGhpcy5zdWJuZXQgPSB0aGlzLnZwYy5wdWJsaWNTdWJuZXRzWzBdO1xuXG4gICAgLy8gQ3JlYXRlIFNlY3VyaXR5IEdyb3VwIGZvciBXaXJlR3VhcmRcbiAgICB0aGlzLnNlY3VyaXR5R3JvdXAgPSBuZXcgZWMyLlNlY3VyaXR5R3JvdXAodGhpcywgXCJTZWN1cml0eUdyb3VwXCIsIHtcbiAgICAgIHZwYzogdGhpcy52cGMsXG4gICAgICBkZXNjcmlwdGlvbjogXCJTZWN1cml0eSBncm91cCBmb3IgV2lyZUd1YXJkIFZQTiBzZXJ2ZXJcIixcbiAgICAgIGFsbG93QWxsT3V0Ym91bmQ6IHRydWUsXG4gICAgfSk7XG5cbiAgICAvLyBBbGxvdyBXaXJlR3VhcmQgVURQIHRyYWZmaWNcbiAgICB0aGlzLnNlY3VyaXR5R3JvdXAuYWRkSW5ncmVzc1J1bGUoXG4gICAgICBlYzIuUGVlci5hbnlJcHY0KCksXG4gICAgICBlYzIuUG9ydC51ZHAocHJvcHMud2lyZWd1YXJkUG9ydCksXG4gICAgICBcIkFsbG93IFdpcmVHdWFyZCBVRFAgdHJhZmZpY1wiLFxuICAgICk7XG5cbiAgICAvLyBBbGxvdyBTU0ggYWNjZXNzIGlmIGVuYWJsZWRcbiAgICBpZiAoZW5hYmxlU3NoKSB7XG4gICAgICB0aGlzLnNlY3VyaXR5R3JvdXAuYWRkSW5ncmVzc1J1bGUoXG4gICAgICAgIGVjMi5QZWVyLmFueUlwdjQoKSxcbiAgICAgICAgZWMyLlBvcnQudGNwKDIyKSxcbiAgICAgICAgXCJBbGxvdyBTU0ggYWNjZXNzXCIsXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEFkZCB0YWdzXG4gICAgY2RrLlRhZ3Mub2YodGhpcy52cGMpLmFkZChcIk5hbWVcIiwgXCJzdGluZ3ktdnBuLXZwY1wiKTtcbiAgICBjZGsuVGFncy5vZih0aGlzLnNlY3VyaXR5R3JvdXApLmFkZChcIk5hbWVcIiwgXCJzdGluZ3ktdnBuLXNnXCIpO1xuICB9XG59XG4iXX0=